{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport MessageDTO from '../../src/MessageDTO';\nimport User from '../../src/User';\nimport Attachment from '../../src/Attachement';\nimport axios from 'axios';\nexport default {\n  data() {\n    return {\n      mail_message: \"\",\n      attachements: [],\n      att_count: 0,\n      isDropdown: false,\n      recipients: \"\",\n      msg_subject: \"\",\n      msg_priority: 1 // TODO: change this to v-model like the rest\n    };\n  },\n  mounted() {\n    document.addEventListener(\"click\", this.closeDropdown);\n  },\n  beforeDestroy() {\n    document.removeEventListener(\"click\", this.closeDropdown);\n  },\n  methods: {\n    close() {\n      this.$emit('close_composer');\n    },\n    handleTab(event) {\n      const textarea = event.target;\n      const start = textarea.selectionStart;\n      const end = textarea.selectionEnd;\n      this.mail_message = this.mail_message.substring(0, start) + \"\\t\" + this.mail_message.substring(end);\n      textarea.setSelectionRange(start + 1, start + 1);\n    },\n    handleFileChange(event) {\n      const file = event.target.files[0];\n      let file_name = file.name; // Save the filename with extension\n      // Extract file extension\n      let fileExtension = file_name.split('.').pop(); // Get the last part after the last dot\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n      reader.onload = () => {\n        base64String = reader.result.split(',')[1];\n        fileExtension = fileExtension.toLowerCase(); // Save the extension in a variable\n        this.attachements.push(new Attachment(file_name, fileExtension, base64String));\n        this.att_count++;\n      };\n    },\n    formatFileSize(size) {\n      const kbSize = size / 1024;\n      if (kbSize < 1024) {\n        return kbSize.toFixed(2) + 'KB';\n      } else {\n        return (kbSize / 1024).toFixed(2) + 'MB';\n      }\n    },\n    toggleDropDown() {\n      this.isDropdown = !this.isDropdown;\n    },\n    closeDropdown(event) {\n      const dropdownElement = this.$refs.dropdown;\n      if (dropdownElement && !dropdownElement.contains(event.target)) {\n        this.isDropdown = false;\n      }\n    },\n    remove_attachement(attachement, index) {\n      console.log(attachement);\n      this.attachements.splice(index, 1);\n    },\n    send() {\n      // TODO: send message\n      let sender_id = 1; //TODO: change this to actual user id\n      let sender_username = \"duncan.runolfsdottir\"; //TODO:change this to actual username\n      let sender = new User(sender_username, sender_id);\n      let recipients_arr = this.recipients.split(' ');\n      if (recipients_arr.length === 1 && recipients_arr[0] === \"\") {\n        console.log('ERROR! No recipients.');\n        return;\n      }\n      let msg_dto = new MessageDTO(0, sender, recipients_arr, Date.now(), this.msg_priority, this.subject, this.mail_message, this.attachements, null);\n      this.requestSendMessage(msg_dto);\n    },\n    async requestSendMessage(messageDTO) {\n      const url = 'http://172.20.10.4:8081/api/messages/send'; // Replace with your actual API endpoint\n      console.log(messageDTO);\n      try {\n        const response = await axios.post(url, messageDTO);\n        console.log('Message sent successfully:', response.data);\n        this.$emit('close_composer');\n        return response.data;\n      } catch (error) {\n        console.error('Error sending message:', error.message);\n        throw error;\n      }\n    },\n    discard() {\n      // TODO: differentiate between discard message(inside box event) and save to draft(outside event)\n      this.$emit('close_composer');\n    }\n  }\n};","map":{"version":3,"names":["MessageDTO","User","Attachment","axios","data","mail_message","attachements","att_count","isDropdown","recipients","msg_subject","msg_priority","mounted","document","addEventListener","closeDropdown","beforeDestroy","removeEventListener","methods","close","$emit","handleTab","event","textarea","target","start","selectionStart","end","selectionEnd","substring","setSelectionRange","handleFileChange","file","files","file_name","name","fileExtension","split","pop","reader","FileReader","readAsDataURL","onload","base64String","result","toLowerCase","push","formatFileSize","size","kbSize","toFixed","toggleDropDown","dropdownElement","$refs","dropdown","contains","remove_attachement","attachement","index","console","log","splice","send","sender_id","sender_username","sender","recipients_arr","length","msg_dto","Date","now","subject","requestSendMessage","messageDTO","url","response","post","error","message","discard"],"sources":["/home/moustafa/Me/Projects/Mail/vault_mail/src/components/Composer.vue"],"sourcesContent":["<template>\n    <div class=\"backdrop\" @click.self=\"close\">\n      <div class=\"composer\">\n          <input v-model=\"recipients\" type=\"text\" class=\"message_attributes\" placeholder=\"Recipients\">\n          <input v-model=\"subject\" type=\"text\" class=\"message_attributes\" placeholder=\"Subject\">\n          <textarea v-model=\"mail_message\" class=\"message\" @keydown.tab.prevent=\"handleTab\" spellcheck=\"false\" placeholder=\"Type your mail message ...\"></textarea>\n          <div class=\"bottom\">\n              <div class=\"left\">\n                  <button class=\"send\" title=\"Send\" @click=\"send\"><font-awesome-icon icon=\"paper-plane\" class=\"icon\"/></button>\n                  <label for=\"file-input\" class=\"file-label\">\n                      <font-awesome-icon icon=\"paperclip\" class=\"icon\" title=\"Insert Attachement\"/>\n                      <input type=\"file\" id=\"file-input\" @change=\"handleFileChange\">\n                  </label>\n                  <button v-if=\"attachements && attachements.length>0\" class=\"send\" title=\"List Attachements\" @click.stop=\"toggleDropDown\"><font-awesome-icon icon=\"angle-up\" class=\"smaller-icon\"/></button>\n                  <div class=\"dropdown_container\" @click.stop>\n                      <div v-if=\"isDropdown && attachements.length>0\" class=\"dropdown\" ref=\"dropdown\">\n                          <ul>\n                              <li v-for=\"(attachement, index) in attachements\" :key=\"index\">{{ attachement.name.substring(0,20) }}<button @click=\"remove_attachement(attachement, index)\"><font-awesome-icon icon=\"minus\"/></button></li>\n                          </ul>\n                      </div>\n                  </div>\n              </div>\n              <button class=\"send\" title=\"Discard Draft\" @click=\"discard\"><font-awesome-icon icon=\"trash\" class=\"icon\"/></button>\n          </div>\n      </div>\n    </div>\n  </template>\n  \n  <script>\n  import MessageDTO from '../../src/MessageDTO';\n  import User from '../../src/User';\n  import Attachment from '../../src/Attachement';\n  import axios from 'axios';\n  export default {\n      data(){\n          return{\n              mail_message: \"\",\n              attachements: [],\n              att_count: 0,\n              isDropdown: false,\n              recipients: \"\",\n              msg_subject: \"\",\n              msg_priority: 1,// TODO: change this to v-model like the rest\n          }\n      },\n      mounted() {\n          document.addEventListener(\"click\", this.closeDropdown);\n      },\n      beforeDestroy() {\n          document.removeEventListener(\"click\", this.closeDropdown);\n      },\n      methods: {\n          close(){\n              this.$emit('close_composer');\n          },\n          handleTab(event){\n              const textarea = event.target;\n              const start = textarea.selectionStart;\n              const end = textarea.selectionEnd;\n              \n              this.mail_message = this.mail_message.substring(0, start) + \"\\t\" + this.mail_message.substring(end);\n  \n              textarea.setSelectionRange(start + 1, start + 1);\n          },\n          handleFileChange(event){\n              const file= event.target.files[0];\n              \n              let file_name = file.name; // Save the filename with extension\n               // Extract file extension\n              let fileExtension = file_name.split('.').pop(); // Get the last part after the last dot\n              const reader = new FileReader();\n              reader.readAsDataURL(file);\n              reader.onload = () => {\n                  base64String = reader.result.split(',')[1];\n                  fileExtension = fileExtension.toLowerCase(); // Save the extension in a variable\n                  this.attachements.push(new Attachment(file_name,fileExtension,base64String));\n                  this.att_count++;            \n              };\n  \n          },\n          formatFileSize(size){\n              const kbSize = size/1024;\n              if(kbSize<1024) {\n                  return kbSize.toFixed(2) + 'KB';\n              } else {\n                  return (kbSize / 1024).toFixed(2) + 'MB';\n              }\n          },\n  \n          toggleDropDown(){\n              this.isDropdown = !this.isDropdown;\n          },\n          closeDropdown(event) {\n              const dropdownElement = this.$refs.dropdown;\n  \n              if (dropdownElement && !dropdownElement.contains(event.target)) {\n                  this.isDropdown = false;\n              }\n          },\n          remove_attachement(attachement, index){\n              console.log(attachement)\n              this.attachements.splice(index, 1)\n          },\n          send() {\n              // TODO: send message\n              let sender_id = 1//TODO: change this to actual user id\n              let sender_username = \"duncan.runolfsdottir\"//TODO:change this to actual username\n              let sender = new User(sender_username,sender_id);\n          \n              let recipients_arr = this.recipients.split(' ');\n              if (recipients_arr.length === 1 && recipients_arr[0]===\"\"){\n                  console.log('ERROR! No recipients.')\n                  return;\n              }\n              let msg_dto = new MessageDTO(0,sender,recipients_arr, Date.now(),this.msg_priority,this.subject,this.mail_message,this.attachements,null); \n              this.requestSendMessage(msg_dto);  \n          },\n          async requestSendMessage(messageDTO){\n              const url = 'http://172.20.10.4:8081/api/messages/send'; // Replace with your actual API endpoint\n              console.log(messageDTO);\n              try {\n              const response = await axios.post(url, messageDTO);\n  \n              console.log('Message sent successfully:', response.data);\n              this.$emit('close_composer')\n  \n              return response.data;\n              } catch (error) {\n                  console.error('Error sending message:', error.message);\n              throw error;\n              }\n  \n          },\n          discard(){\n              // TODO: differentiate between discard message(inside box event) and save to draft(outside event)\n              this.$emit('close_composer')\n          }\n      }\n  }\n  </script>\n  \n  <style>\n  .backdrop {\n      top: 0;\n      position: fixed;\n      background: rgba(0,0,0,0.6);\n      width: 100%;\n      height: 100%;\n  }\n  \n  .composer {\n      width: 40%;\n      padding: 20px 20px 30px 20px;\n      margin: 150px auto;\n      background: #d6edfa;\n      height: 55%;\n      border-radius: 10px;\n  }\n  .composer .message_attributes{\n      width: 100%;\n      margin-bottom: 5px;\n      border: none;\n      border-bottom: 1px solid rgba(146, 146, 146, 0.8);\n      background: none;\n  }\n  \n  .composer .message{\n      width:100%;\n      height: 82%;\n      margin-top: 15px;\n      margin-bottom: 0.5%;\n      text-align: left;\n      background: none;\n      border: none;\n      border-bottom: 1px solid rgba(146, 146, 146, 0.8);\n      border-left: 1px solid rgba(146, 146, 146, 0.8);\n      resize: none;\n      overflow-y: auto;\n  }\n  \n  .composer .bottom{\n      display: flex;\n      justify-content: space-between;\n  }\n  .composer .left{\n      display: flex;\n  }\n  .composer .send{\n      margin-left: 0;\n      height: 40px;\n      width: 40px;\n      background: none;\n      border: none;\n      cursor: pointer;\n      color: #023047;\n  }\n  \n  .composer .send:hover{\n      border-radius: 50%;\n      background-color: #FB8500\n  }\n  .composer .icon{\n      font-size: 20px;\n  }\n  \n  .composer .file-label{\n      padding: 10px 12px;\n      background: none;\n      border: none;\n      cursor: pointer;\n      color: #023047;\n  }\n  .composer .file-label:hover{\n      border-radius: 50%;\n      background-color: #FB8500\n  }\n  .composer .smaller-icon{\n      font-size: 16px;\n      color: #023047;\n  }\n  .composer .bottom input[type=\"file\"]{\n      display :none;\n  }\n  \n  .composer .dropdown_container{\n      position: relative;\n      right: 16%;\n      bottom: 95%\n  }\n  .composer .dropdown_container .dropdown{\n      background: #f7e8c7;\n      border: 1px solid #023047;\n      border-radius: 3%;\n      padding: 0;\n      width: 180px;\n  }\n  .dropdown ul{\n      padding-left: 10%;\n      list-style: none;\n      color: #023047;\n  }\n  .dropdown ul li{\n      display: flex;\n      justify-content: space-between;\n      font-size: 12px;\n      text-align: left;\n  }\n  .dropdown ul li button{\n      background: none;\n      border: none;\n      cursor: pointer;\n  }\n  </style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}