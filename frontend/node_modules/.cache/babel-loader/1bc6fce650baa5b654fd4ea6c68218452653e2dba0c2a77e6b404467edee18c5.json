{"ast":null,"code":"import { vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, withModifiers as _withModifiers, withKeys as _withKeys, resolveComponent as _resolveComponent, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"composer\"\n};\nconst _hoisted_2 = {\n  class: \"bottom\"\n};\nconst _hoisted_3 = {\n  class: \"left\"\n};\nconst _hoisted_4 = {\n  for: \"file-input\",\n  class: \"file-label\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"dropdown\",\n  ref: \"dropdown\"\n};\nconst _hoisted_6 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_font_awesome_icon = _resolveComponent(\"font-awesome-icon\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: \"backdrop\",\n    onClick: _cache[9] || (_cache[9] = _withModifiers((...args) => $options.close && $options.close(...args), [\"self\"]))\n  }, [_createElementVNode(\"div\", _hoisted_1, [_withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.recipients = $event),\n    type: \"text\",\n    class: \"message_attributes\",\n    placeholder: \"Recipients\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.recipients]]), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.subject = $event),\n    type: \"text\",\n    class: \"message_attributes\",\n    placeholder: \"Subject\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, _ctx.subject]]), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.mail_message = $event),\n    class: \"message\",\n    onKeydown: _cache[3] || (_cache[3] = _withKeys(_withModifiers((...args) => $options.handleTab && $options.handleTab(...args), [\"prevent\"]), [\"tab\"])),\n    spellcheck: \"false\",\n    placeholder: \"Type your mail message ...\"\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelText, $data.mail_message]]), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    class: \"send\",\n    title: \"Send\",\n    onClick: _cache[4] || (_cache[4] = (...args) => $options.send && $options.send(...args))\n  }, [_createVNode(_component_font_awesome_icon, {\n    icon: \"paper-plane\",\n    class: \"icon\"\n  })]), _createElementVNode(\"label\", _hoisted_4, [_createVNode(_component_font_awesome_icon, {\n    icon: \"paperclip\",\n    class: \"icon\",\n    title: \"Insert Attachement\"\n  }), _createElementVNode(\"input\", {\n    type: \"file\",\n    id: \"file-input\",\n    onChange: _cache[5] || (_cache[5] = (...args) => $options.handleFileChange && $options.handleFileChange(...args))\n  }, null, 32 /* NEED_HYDRATION */)]), $data.attachements && $data.attachements.length > 0 ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    class: \"send\",\n    title: \"List Attachements\",\n    onClick: _cache[6] || (_cache[6] = _withModifiers((...args) => $options.toggleDropDown && $options.toggleDropDown(...args), [\"stop\"]))\n  }, [_createVNode(_component_font_awesome_icon, {\n    icon: \"angle-up\",\n    class: \"smaller-icon\"\n  })])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", {\n    class: \"dropdown_container\",\n    onClick: _cache[7] || (_cache[7] = _withModifiers(() => {}, [\"stop\"]))\n  }, [$data.isDropdown && $data.attachements.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.attachements, (attachement, index) => {\n    return _openBlock(), _createElementBlock(\"li\", {\n      key: index\n    }, [_createTextVNode(_toDisplayString(attachement.name.substring(0, 20)), 1 /* TEXT */), _createElementVNode(\"button\", {\n      onClick: $event => $options.remove_attachement(attachement, index)\n    }, [_createVNode(_component_font_awesome_icon, {\n      icon: \"minus\"\n    })], 8 /* PROPS */, _hoisted_6)]);\n  }), 128 /* KEYED_FRAGMENT */))])], 512 /* NEED_PATCH */)) : _createCommentVNode(\"v-if\", true)])]), _createElementVNode(\"button\", {\n    class: \"send\",\n    title: \"Discard Draft\",\n    onClick: _cache[8] || (_cache[8] = (...args) => $options.discard && $options.discard(...args))\n  }, [_createVNode(_component_font_awesome_icon, {\n    icon: \"trash\",\n    class: \"icon\"\n  })])])])]);\n}","map":{"version":3,"names":["class","for","ref","_createElementBlock","onClick","_cache","_withModifiers","args","$options","close","_createElementVNode","_hoisted_1","$data","recipients","$event","type","placeholder","_ctx","subject","mail_message","onKeydown","_withKeys","handleTab","spellcheck","_hoisted_2","_hoisted_3","title","send","_createVNode","_component_font_awesome_icon","icon","_hoisted_4","id","onChange","handleFileChange","attachements","length","toggleDropDown","isDropdown","_hoisted_5","_Fragment","_renderList","attachement","index","key","name","substring","remove_attachement","discard"],"sources":["/home/moustafa/Me/Projects/Mail/vault_mail/src/components/Composer.vue"],"sourcesContent":["<template>\n    <div class=\"backdrop\" @click.self=\"close\">\n      <div class=\"composer\">\n          <input v-model=\"recipients\" type=\"text\" class=\"message_attributes\" placeholder=\"Recipients\">\n          <input v-model=\"subject\" type=\"text\" class=\"message_attributes\" placeholder=\"Subject\">\n          <textarea v-model=\"mail_message\" class=\"message\" @keydown.tab.prevent=\"handleTab\" spellcheck=\"false\" placeholder=\"Type your mail message ...\"></textarea>\n          <div class=\"bottom\">\n              <div class=\"left\">\n                  <button class=\"send\" title=\"Send\" @click=\"send\"><font-awesome-icon icon=\"paper-plane\" class=\"icon\"/></button>\n                  <label for=\"file-input\" class=\"file-label\">\n                      <font-awesome-icon icon=\"paperclip\" class=\"icon\" title=\"Insert Attachement\"/>\n                      <input type=\"file\" id=\"file-input\" @change=\"handleFileChange\">\n                  </label>\n                  <button v-if=\"attachements && attachements.length>0\" class=\"send\" title=\"List Attachements\" @click.stop=\"toggleDropDown\"><font-awesome-icon icon=\"angle-up\" class=\"smaller-icon\"/></button>\n                  <div class=\"dropdown_container\" @click.stop>\n                      <div v-if=\"isDropdown && attachements.length>0\" class=\"dropdown\" ref=\"dropdown\">\n                          <ul>\n                              <li v-for=\"(attachement, index) in attachements\" :key=\"index\">{{ attachement.name.substring(0,20) }}<button @click=\"remove_attachement(attachement, index)\"><font-awesome-icon icon=\"minus\"/></button></li>\n                          </ul>\n                      </div>\n                  </div>\n              </div>\n              <button class=\"send\" title=\"Discard Draft\" @click=\"discard\"><font-awesome-icon icon=\"trash\" class=\"icon\"/></button>\n          </div>\n      </div>\n    </div>\n  </template>\n  \n  <script>\n  import MessageDTO from '../../src/MessageDTO';\n  import User from '../../src/User';\n  import Attachment from '../../src/Attachment';\n  import axios from 'axios';\n  export default {\n      data(){\n          return{\n              mail_message: \"\",\n              attachements: [],\n              att_count: 0,\n              isDropdown: false,\n              recipients: \"\",\n              msg_subject: \"\",\n              msg_priority: 1,// TODO: change this to v-model like the rest\n          }\n      },\n      mounted() {\n          document.addEventListener(\"click\", this.closeDropdown);\n      },\n      beforeDestroy() {\n          document.removeEventListener(\"click\", this.closeDropdown);\n      },\n      methods: {\n          close(){\n              this.$emit('close_composer');\n          },\n          handleTab(event){\n              const textarea = event.target;\n              const start = textarea.selectionStart;\n              const end = textarea.selectionEnd;\n              \n              this.mail_message = this.mail_message.substring(0, start) + \"\\t\" + this.mail_message.substring(end);\n  \n              textarea.setSelectionRange(start + 1, start + 1);\n          },\n          handleFileChange(event){\n              const file= event.target.files[0];\n              \n              let file_name = file.name; // Save the filename with extension\n               // Extract file extension\n              let fileExtension = file_name.split('.').pop(); // Get the last part after the last dot\n              const reader = new FileReader();\n              reader.readAsDataURL(file);\n              reader.onload = () => {\n                  base64String = reader.result.split(',')[1];\n                  fileExtension = fileExtension.toLowerCase(); // Save the extension in a variable\n                  this.attachements.push(new Attachment(file_name,fileExtension,base64String));\n                  this.att_count++;            \n              };\n  \n          },\n          formatFileSize(size){\n              const kbSize = size/1024;\n              if(kbSize<1024) {\n                  return kbSize.toFixed(2) + 'KB';\n              } else {\n                  return (kbSize / 1024).toFixed(2) + 'MB';\n              }\n          },\n  \n          toggleDropDown(){\n              this.isDropdown = !this.isDropdown;\n          },\n          closeDropdown(event) {\n              const dropdownElement = this.$refs.dropdown;\n  \n              if (dropdownElement && !dropdownElement.contains(event.target)) {\n                  this.isDropdown = false;\n              }\n          },\n          remove_attachement(attachement, index){\n              console.log(attachement)\n              this.attachements.splice(index, 1)\n          },\n          send() {\n              // TODO: send message\n              let sender_id = 1//TODO: change this to actual user id\n              let sender_username = \"duncan.runolfsdottir\"//TODO:change this to actual username\n              let sender = new User(sender_username,sender_id);\n          \n              let recipients_arr = this.recipients.split(' ');\n              if (recipients_arr.length === 1 && recipients_arr[0]===\"\"){\n                  console.log('ERROR! No recipients.')\n                  return;\n              }\n              let msg_dto = new MessageDTO(0,sender,recipients_arr, Date.now(),this.msg_priority,this.subject,this.mail_message,this.attachements,null); \n              this.requestSendMessage(msg_dto);  \n          },\n          async requestSendMessage(messageDTO){\n              const url = 'http://192.168.1.76:8081/api/messages/send'; // Replace with your actual API endpoint\n              console.log(messageDTO);\n              try {\n              const response = await axios.post(url, messageDTO);\n  \n              console.log('Message sent successfully:', response.data);\n              this.$emit('close_composer')\n  \n              return response.data;\n              } catch (error) {\n                  console.error('Error sending message:', error.message);\n              throw error;\n              }\n  \n          },\n          discard(){\n              // TODO: differentiate between discard message(inside box event) and save to draft(outside event)\n              this.$emit('close_composer')\n          }\n      }\n  }\n  </script>\n  \n  <style>\n  .backdrop {\n      top: 0;\n      position: fixed;\n      background: rgba(0,0,0,0.6);\n      width: 100%;\n      height: 100%;\n  }\n  \n  .composer {\n      width: 40%;\n      padding: 20px 20px 30px 20px;\n      margin: 150px auto;\n      background: #d6edfa;\n      height: 55%;\n      border-radius: 10px;\n  }\n  .composer .message_attributes{\n      width: 100%;\n      margin-bottom: 5px;\n      border: none;\n      border-bottom: 1px solid rgba(146, 146, 146, 0.8);\n      background: none;\n  }\n  \n  .composer .message{\n      width:100%;\n      height: 82%;\n      margin-top: 15px;\n      margin-bottom: 0.5%;\n      text-align: left;\n      background: none;\n      border: none;\n      border-bottom: 1px solid rgba(146, 146, 146, 0.8);\n      border-left: 1px solid rgba(146, 146, 146, 0.8);\n      resize: none;\n      overflow-y: auto;\n  }\n  \n  .composer .bottom{\n      display: flex;\n      justify-content: space-between;\n  }\n  .composer .left{\n      display: flex;\n  }\n  .composer .send{\n      margin-left: 0;\n      height: 40px;\n      width: 40px;\n      background: none;\n      border: none;\n      cursor: pointer;\n      color: #023047;\n  }\n  \n  .composer .send:hover{\n      border-radius: 50%;\n      background-color: #FB8500\n  }\n  .composer .icon{\n      font-size: 20px;\n  }\n  \n  .composer .file-label{\n      padding: 10px 12px;\n      background: none;\n      border: none;\n      cursor: pointer;\n      color: #023047;\n  }\n  .composer .file-label:hover{\n      border-radius: 50%;\n      background-color: #FB8500\n  }\n  .composer .smaller-icon{\n      font-size: 16px;\n      color: #023047;\n  }\n  .composer .bottom input[type=\"file\"]{\n      display :none;\n  }\n  \n  .composer .dropdown_container{\n      position: relative;\n      right: 16%;\n      bottom: 95%\n  }\n  .composer .dropdown_container .dropdown{\n      background: #f7e8c7;\n      border: 1px solid #023047;\n      border-radius: 3%;\n      padding: 0;\n      width: 180px;\n  }\n  .dropdown ul{\n      padding-left: 10%;\n      list-style: none;\n      color: #023047;\n  }\n  .dropdown ul li{\n      display: flex;\n      justify-content: space-between;\n      font-size: 12px;\n      text-align: left;\n  }\n  .dropdown ul li button{\n      background: none;\n      border: none;\n      cursor: pointer;\n  }\n  </style>"],"mappings":";;EAEWA,KAAK,EAAC;AAAU;;EAIZA,KAAK,EAAC;AAAQ;;EACVA,KAAK,EAAC;AAAM;;EAENC,GAAG,EAAC,YAAY;EAACD,KAAK,EAAC;;;;EAMsBA,KAAK,EAAC,UAAU;EAACE,GAAG,EAAC;;;;;uBAdvFC,mBAAA,CAwBM;IAxBDH,KAAK,EAAC,UAAU;IAAEI,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAC,cAAA,KAAAC,IAAA,KAAOC,QAAA,CAAAC,KAAA,IAAAD,QAAA,CAAAC,KAAA,IAAAF,IAAA,CAAK;MACtCG,mBAAA,CAsBM,OAtBNC,UAsBM,G,gBArBFD,mBAAA,CAA4F;+DAA5EE,KAAA,CAAAC,UAAU,GAAAC,MAAA;IAAEC,IAAI,EAAC,MAAM;IAACf,KAAK,EAAC,oBAAoB;IAACgB,WAAW,EAAC;iDAA/DJ,KAAA,CAAAC,UAAU,E,mBAC1BH,mBAAA,CAAsF;+DAAtEO,IAAA,CAAAC,OAAO,GAAAJ,MAAA;IAAEC,IAAI,EAAC,MAAM;IAACf,KAAK,EAAC,oBAAoB;IAACgB,WAAW,EAAC;iDAA5DC,IAAA,CAAAC,OAAO,E,mBACvBR,mBAAA,CAAyJ;+DAAtIE,KAAA,CAAAO,YAAY,GAAAL,MAAA;IAAEd,KAAK,EAAC,SAAS;IAAEoB,SAAO,EAAAf,MAAA,QAAAA,MAAA,MAAAgB,SAAA,CAAAf,cAAA,KAAAC,IAAA,KAAcC,QAAA,CAAAc,SAAA,IAAAd,QAAA,CAAAc,SAAA,IAAAf,IAAA,CAAS;IAAEgB,UAAU,EAAC,OAAO;IAACP,WAAW,EAAC;iEAA9FJ,KAAA,CAAAO,YAAY,E,GAC/BT,mBAAA,CAiBM,OAjBNc,UAiBM,GAhBFd,mBAAA,CAcM,OAdNe,UAcM,GAbFf,mBAAA,CAA6G;IAArGV,KAAK,EAAC,MAAM;IAAC0B,KAAK,EAAC,MAAM;IAAEtB,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAE,IAAA,KAAEC,QAAA,CAAAmB,IAAA,IAAAnB,QAAA,CAAAmB,IAAA,IAAApB,IAAA,CAAI;MAAEqB,YAAA,CAAoDC,4BAAA;IAAjCC,IAAI,EAAC,aAAa;IAAC9B,KAAK,EAAC;QAC5FU,mBAAA,CAGQ,SAHRqB,UAGQ,GAFJH,YAAA,CAA6EC,4BAAA;IAA1DC,IAAI,EAAC,WAAW;IAAC9B,KAAK,EAAC,MAAM;IAAC0B,KAAK,EAAC;MACvDhB,mBAAA,CAA8D;IAAvDK,IAAI,EAAC,MAAM;IAACiB,EAAE,EAAC,YAAY;IAAEC,QAAM,EAAA5B,MAAA,QAAAA,MAAA,UAAAE,IAAA,KAAEC,QAAA,CAAA0B,gBAAA,IAAA1B,QAAA,CAAA0B,gBAAA,IAAA3B,IAAA,CAAgB;uCAElDK,KAAA,CAAAuB,YAAY,IAAIvB,KAAA,CAAAuB,YAAY,CAACC,MAAM,Q,cAAjDjC,mBAAA,CAA2L;;IAAtIH,KAAK,EAAC,MAAM;IAAC0B,KAAK,EAAC,mBAAmB;IAAEtB,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAC,cAAA,KAAAC,IAAA,KAAOC,QAAA,CAAA6B,cAAA,IAAA7B,QAAA,CAAA6B,cAAA,IAAA9B,IAAA,CAAc;MAAEqB,YAAA,CAAyDC,4BAAA;IAAtCC,IAAI,EAAC,UAAU;IAAC9B,KAAK,EAAC;6CAClKU,mBAAA,CAMM;IANDV,KAAK,EAAC,oBAAoB;IAAEI,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAC,cAAA,CAAN,QAAW;MAC5BM,KAAA,CAAA0B,UAAU,IAAI1B,KAAA,CAAAuB,YAAY,CAACC,MAAM,Q,cAA5CjC,mBAAA,CAIM,OAJNoC,UAIM,GAHF7B,mBAAA,CAEK,c,kBADDP,mBAAA,CAA2MqC,SAAA,QAAAC,WAAA,CAAxK7B,KAAA,CAAAuB,YAAY,GAAnCO,WAAW,EAAEC,KAAK;yBAA9BxC,mBAAA,CAA2M;MAAzJyC,GAAG,EAAED;IAAK,I,kCAAKD,WAAW,CAACG,IAAI,CAACC,SAAS,yBAASpC,mBAAA,CAAkG;MAAzFN,OAAK,EAAAU,MAAA,IAAEN,QAAA,CAAAuC,kBAAkB,CAACL,WAAW,EAAEC,KAAK;QAAGf,YAAA,CAAiCC,4BAAA;MAAdC,IAAI,EAAC;IAAO,G;qGAK3MpB,mBAAA,CAAmH;IAA3GV,KAAK,EAAC,MAAM;IAAC0B,KAAK,EAAC,eAAe;IAAEtB,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAE,IAAA,KAAEC,QAAA,CAAAwC,OAAA,IAAAxC,QAAA,CAAAwC,OAAA,IAAAzC,IAAA,CAAO;MAAEqB,YAAA,CAA8CC,4BAAA;IAA3BC,IAAI,EAAC,OAAO;IAAC9B,KAAK,EAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}