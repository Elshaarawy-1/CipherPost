{"ast":null,"code":"import _regeneratorRuntime from \"/home/go3rany/cipherpost/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/go3rany/cipherpost/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _createForOfIteratorHelper from \"/home/go3rany/cipherpost/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport MessageDTO from '../../src/MessageDTO';\nimport User from '../../src/User';\nimport Attachment from '../../src/Attachment';\nimport axios from 'axios';\nexport default {\n  data: function data() {\n    return {\n      mail_message: \"\",\n      attachements: [],\n      att_count: 0,\n      isDropdown: false,\n      recipients: \"\",\n      msg_subject: \"\",\n      msg_priority: 1 // TODO: change this to v-model like the rest\n    };\n  },\n  mounted: function mounted() {\n    document.addEventListener(\"click\", this.closeDropdown);\n  },\n  beforeDestroy: function beforeDestroy() {\n    document.removeEventListener(\"click\", this.closeDropdown);\n  },\n  methods: {\n    close: function close() {\n      this.$emit('close_composer');\n    },\n    handleTab: function handleTab(event) {\n      var textarea = event.target;\n      var start = textarea.selectionStart;\n      var end = textarea.selectionEnd;\n      this.mail_message = this.mail_message.substring(0, start) + \"\\t\" + this.mail_message.substring(end);\n      textarea.setSelectionRange(start + 1, start + 1);\n    },\n    handleFileChange: function handleFileChange(event) {\n      var _this = this;\n      var file = event.target.files[0];\n      var file_name = file.name; // Save the filename with extension\n      // Extract file extension\n      var fileExtension = file_name.split('.').pop(); // Get the last part after the last dot\n      var reader = new FileReader();\n      reader.readAsDataURL(file);\n      reader.onload = function () {\n        base64String = reader.result.split(',')[1];\n        fileExtension = fileExtension.toLowerCase(); // Save the extension in a variable\n        _this.attachements.push(new Attachment(file_name, fileExtension, base64String));\n        _this.att_count++;\n      };\n    },\n    formatFileSize: function formatFileSize(size) {\n      var kbSize = size / 1024;\n      if (kbSize < 1024) {\n        return kbSize.toFixed(2) + 'KB';\n      } else {\n        return (kbSize / 1024).toFixed(2) + 'MB';\n      }\n    },\n    toggleDropDown: function toggleDropDown() {\n      this.isDropdown = !this.isDropdown;\n    },\n    closeDropdown: function closeDropdown(event) {\n      var dropdownElement = this.$refs.dropdown;\n      if (dropdownElement && !dropdownElement.contains(event.target)) {\n        this.isDropdown = false;\n      }\n    },\n    remove_attachement: function remove_attachement(attachement, index) {\n      console.log(attachement);\n      this.attachements.splice(index, 1);\n    },\n    send: function send() {\n      // TODO: send message\n      var sender_id = 1; //TODO: change this to actual user id\n      var sender_username = \"duncan.runolfsdottir\"; //TODO:change this to actual username\n      var sender = new User(sender_username, sender_id);\n      var recipients_arr = this.recipients.split(' ');\n      if (recipients_arr.length === 1 && recipients_arr[0] == 1) {\n        console.log('ERROR! No recipients.');\n        return;\n      }\n      var user_recipients = [];\n      var _iterator = _createForOfIteratorHelper(recipients_arr),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var reciever = _step.value;\n          user_recipients.push(new User(reciever, 4)); // TODO: change 0 to actual id or skip\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      var msg_dto = new MessageDTO(sender, user_recipients, user_recipients, this.msg_priority, this.subject, this.mail_message, this.attachements);\n      this.requestSendMessage(msg_dto);\n      this.$emit('close_composer');\n    },\n    requestSendMessage: function requestSendMessage(messageDTO) {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var url, response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              url = 'http://192.168.1.76:8081/api/messages/send'; // Replace with your actual API endpoint\n              console.log(messageDTO);\n              _context.prev = 2;\n              _context.next = 5;\n              return axios.post(url, messageDTO);\n            case 5:\n              response = _context.sent;\n              console.log('Message sent successfully:', response.data);\n              // TODO: close compose message\n              return _context.abrupt(\"return\", response.data);\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](2);\n              console.error('Error sending message:', _context.t0.message);\n              throw _context.t0;\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[2, 10]]);\n      }))();\n    },\n    discard: function discard() {\n      this.$emit('close_composer');\n    }\n  }\n};","map":{"version":3,"names":["MessageDTO","User","Attachment","axios","data","mail_message","attachements","att_count","isDropdown","recipients","msg_subject","msg_priority","mounted","document","addEventListener","closeDropdown","beforeDestroy","removeEventListener","methods","close","$emit","handleTab","event","textarea","target","start","selectionStart","end","selectionEnd","substring","setSelectionRange","handleFileChange","_this","file","files","file_name","name","fileExtension","split","pop","reader","FileReader","readAsDataURL","onload","base64String","result","toLowerCase","push","formatFileSize","size","kbSize","toFixed","toggleDropDown","dropdownElement","$refs","dropdown","contains","remove_attachement","attachement","index","console","log","splice","send","sender_id","sender_username","sender","recipients_arr","length","user_recipients","_iterator","_createForOfIteratorHelper","_step","s","n","done","reciever","value","err","e","f","msg_dto","subject","requestSendMessage","messageDTO","_asyncToGenerator","_regeneratorRuntime","mark","_callee","url","response","wrap","_callee$","_context","prev","next","post","sent","abrupt","t0","error","message","stop","discard"],"sources":["/home/go3rany/cipherpost/src/components/Composer.vue"],"sourcesContent":["<template>\n  <div class=\"backdrop\" @click.self=\"close\">\n    <div class=\"composer\">\n        <input v-model=\"recipients\" type=\"text\" class=\"message_attributes\" placeholder=\"Recipients\">\n        <input v-model=\"subject\" type=\"text\" class=\"message_attributes\" placeholder=\"Subject\">\n        <textarea v-model=\"mail_message\" class=\"message\" @keydown.tab.prevent=\"handleTab\" spellcheck=\"false\" placeholder=\"Type your mail message ...\"></textarea>\n        <div class=\"bottom\">\n            <div class=\"left\">\n                <button class=\"send\" title=\"Send\" @click=\"send\"><font-awesome-icon icon=\"paper-plane\" class=\"icon\"/></button>\n                <label for=\"file-input\" class=\"file-label\">\n                    <font-awesome-icon icon=\"paperclip\" class=\"icon\" title=\"Insert Attachement\"/>\n                    <input type=\"file\" id=\"file-input\" @change=\"handleFileChange\">\n                </label>\n                <button v-if=\"attachements && attachements.length>0\" class=\"send\" title=\"List Attachements\" @click.stop=\"toggleDropDown\"><font-awesome-icon icon=\"angle-up\" class=\"smaller-icon\"/></button>\n                <div class=\"dropdown_container\" @click.stop>\n                    <div v-if=\"isDropdown && attachements.length>0\" class=\"dropdown\" ref=\"dropdown\">\n                        <ul>\n                            <li v-for=\"(attachement, index) in attachements\" :key=\"index\">{{ attachement.name.substring(0,20) }}<button @click=\"remove_attachement(attachement, index)\"><font-awesome-icon icon=\"minus\"/></button></li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n            <button class=\"send\" title=\"Discard Draft\" @click=\"discard\"><font-awesome-icon icon=\"trash\" class=\"icon\"/></button>\n        </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport MessageDTO from '../../src/MessageDTO';\nimport User from '../../src/User';\nimport Attachment from '../../src/Attachment';\nimport axios from 'axios';\nexport default {\n    data(){\n        return{\n            mail_message: \"\",\n            attachements: [],\n            att_count: 0,\n            isDropdown: false,\n            recipients: \"\",\n            msg_subject: \"\",\n            msg_priority: 1,// TODO: change this to v-model like the rest\n        }\n    },\n    mounted() {\n        document.addEventListener(\"click\", this.closeDropdown);\n    },\n    beforeDestroy() {\n        document.removeEventListener(\"click\", this.closeDropdown);\n    },\n    methods: {\n        close(){\n            this.$emit('close_composer');\n        },\n        handleTab(event){\n            const textarea = event.target;\n            const start = textarea.selectionStart;\n            const end = textarea.selectionEnd;\n            \n            this.mail_message = this.mail_message.substring(0, start) + \"\\t\" + this.mail_message.substring(end);\n\n            textarea.setSelectionRange(start + 1, start + 1);\n        },\n        handleFileChange(event){\n            const file= event.target.files[0];\n            \n            let file_name = file.name; // Save the filename with extension\n             // Extract file extension\n            let fileExtension = file_name.split('.').pop(); // Get the last part after the last dot\n            const reader = new FileReader();\n            reader.readAsDataURL(file);\n            reader.onload = () => {\n                base64String = reader.result.split(',')[1];\n                fileExtension = fileExtension.toLowerCase(); // Save the extension in a variable\n                this.attachements.push(new Attachment(file_name,fileExtension,base64String));\n                this.att_count++;            \n            };\n\n        },\n        formatFileSize(size){\n            const kbSize = size/1024;\n            if(kbSize<1024) {\n                return kbSize.toFixed(2) + 'KB';\n            } else {\n                return (kbSize / 1024).toFixed(2) + 'MB';\n            }\n        },\n\n        toggleDropDown(){\n            this.isDropdown = !this.isDropdown;\n        },\n        closeDropdown(event) {\n            const dropdownElement = this.$refs.dropdown;\n\n            if (dropdownElement && !dropdownElement.contains(event.target)) {\n                this.isDropdown = false;\n            }\n        },\n        remove_attachement(attachement, index){\n            console.log(attachement)\n            this.attachements.splice(index, 1)\n        },\n        send() {\n            // TODO: send message\n            let sender_id = 1//TODO: change this to actual user id\n            let sender_username = \"duncan.runolfsdottir\"//TODO:change this to actual username\n            let sender = new User(sender_username,sender_id);\n        \n            let recipients_arr = this.recipients.split(' ');\n            if (recipients_arr.length === 1 && recipients_arr[0]==1){\n                console.log('ERROR! No recipients.')\n                return;\n            }\n            let user_recipients = []\n            for (const reciever of recipients_arr) {\n                user_recipients.push(new User(reciever, 4)); // TODO: change 0 to actual id or skip\n            }\n            let msg_dto = new MessageDTO(sender,user_recipients, user_recipients,this.msg_priority,this.subject,this.mail_message,this.attachements); \n            this.requestSendMessage(msg_dto);  \n            this.$emit('close_composer')\n        },\n        async requestSendMessage(messageDTO){\n            const url = 'http://192.168.1.76:8081/api/messages/send'; // Replace with your actual API endpoint\n            console.log(messageDTO);\n            try {\n            const response = await axios.post(url, messageDTO);\n\n            console.log('Message sent successfully:', response.data);\n            // TODO: close compose message\n            return response.data;\n            } catch (error) {\n                console.error('Error sending message:', error.message);\n            throw error;\n            }\n\n        },\n        discard(){\n            this.$emit('close_composer')\n        }\n    }\n}\n</script>\n\n<style>\n.backdrop {\n    top: 0;\n    position: fixed;\n    background: rgba(0,0,0,0.6);\n    width: 100%;\n    height: 100%;\n}\n\n.composer {\n    width: 40%;\n    padding: 20px 20px 30px 20px;\n    margin: 150px auto;\n    background: #d6edfa;\n    height: 55%;\n    border-radius: 10px;\n}\n.composer .message_attributes{\n    width: 100%;\n    margin-bottom: 5px;\n    border: none;\n    border-bottom: 1px solid rgba(146, 146, 146, 0.8);\n    background: none;\n}\n\n.composer .message{\n    width:100%;\n    height: 82%;\n    margin-top: 15px;\n    margin-bottom: 0.5%;\n    text-align: left;\n    background: none;\n    border: none;\n    border-bottom: 1px solid rgba(146, 146, 146, 0.8);\n    border-left: 1px solid rgba(146, 146, 146, 0.8);\n    resize: none;\n    overflow-y: auto;\n}\n\n.composer .bottom{\n    display: flex;\n    justify-content: space-between;\n}\n.composer .left{\n    display: flex;\n}\n.composer .send{\n    margin-left: 0;\n    height: 40px;\n    width: 40px;\n    background: none;\n    border: none;\n    cursor: pointer;\n    color: #023047;\n}\n\n.composer .send:hover{\n    border-radius: 50%;\n    background-color: #FB8500\n}\n.composer .icon{\n    font-size: 20px;\n}\n\n.composer .file-label{\n    padding: 10px 12px;\n    background: none;\n    border: none;\n    cursor: pointer;\n    color: #023047;\n}\n.composer .file-label:hover{\n    border-radius: 50%;\n    background-color: #FB8500\n}\n.composer .smaller-icon{\n    font-size: 16px;\n    color: #023047;\n}\n.composer .bottom input[type=\"file\"]{\n    display :none;\n}\n\n.composer .dropdown_container{\n    position: relative;\n    right: 16%;\n    bottom: 95%\n}\n.composer .dropdown_container .dropdown{\n    background: #f7e8c7;\n    border: 1px solid #023047;\n    border-radius: 3%;\n    padding: 0;\n    width: 180px;\n}\n.dropdown ul{\n    padding-left: 10%;\n    list-style: none;\n    color: #023047;\n}\n.dropdown ul li{\n    display: flex;\n    justify-content: space-between;\n    font-size: 12px;\n    text-align: left;\n}\n.dropdown ul li button{\n    background: none;\n    border: none;\n    cursor: pointer;\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}